<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>World Bank Economic Data Viewer</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f8f9fa;
      margin: 0;
      padding: 20px;
    }
    header {
      background-color: #1abc9c;
      color: white;
      text-align: center;
      padding: 20px;
      border-radius: 10px;
    }
    h1 { margin: 0; }
    #controls {
      margin: 20px 0;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    select, input, button {
      padding: 10px;
      font-size: 16px;
    }
    canvas {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    footer {
      margin-top: 40px;
      padding: 10px;
      text-align: center;
      background-color: #ecf0f1;
      border-radius: 5px;
      font-weight: bold;
      color: #2c3e50;
    }
  </style>
</head>
<body>

<header>
  <h1>üåç Economic Data Viewer</h1>
  <p>Powered by World Bank API</p>
</header>

<div id="controls">
  <select id="countrySelect"></select>

  <select id="indicatorSelect">
    <option value="NY.GDP.MKTP.KD.ZG">GDP Growth (%)</option>
    <option value="NY.GDP.PCAP.KD.ZG">GDP per capita Growth (%)</option>
    <option value="FP.CPI.TOTL.ZG">Inflation (% annual)</option>
    <option value="SL.UEM.TOTL.ZS">Unemployment (% total)</option>
    <option value="SP.POP.GROW">Population Growth (%)</option>
  </select>

  <input type="number" id="startYear" placeholder="Start Year" min="1960" max="2024" value="2000">
  <input type="number" id="endYear" placeholder="End Year" min="1960" max="2024" value="2023">

  <select id="chartType">
    <option value="line">Line</option>
    <option value="bar">Bar</option>
    <option value="scatter">Scatter</option>
  </select>

  <button onclick="fetchData()">üìä Show</button>
  <button onclick="downloadExcel()">‚¨áÔ∏è Download Excel</button>
</div>

<canvas id="dataChart" height="100"></canvas>

<footer>Concept by ANOOF ‚Äì Developed with ‚ô• using World Bank Data</footer>

<script>
  let chart;
  let excelData = [];

  // Load country list from World Bank API
  async function populateCountries() {
    const response = await fetch('https://api.worldbank.org/v2/country?format=json&per_page=300');
    const data = await response.json();
    const countries = data[1];

    const select = document.getElementById('countrySelect');
    select.innerHTML = '';

    countries
      .filter(c => c.region.id !== "NA")
      .slice(0, 100)
      .forEach(c => {
        const option = document.createElement('option');
        option.value = c.id;
        option.textContent = c.name;
        select.appendChild(option);
      });
  }

  async function fetchData() {
    const country = document.getElementById("countrySelect").value;
    const indicator = document.getElementById("indicatorSelect").value;
    const chartType = document.getElementById("chartType").value;
    const startYear = parseInt(document.getElementById("startYear").value);
    const endYear = parseInt(document.getElementById("endYear").value);

    if (isNaN(startYear) || isNaN(endYear) || startYear > endYear) {
      alert("Please enter a valid year range.");
      return;
    }

    const url = `https://api.worldbank.org/v2/country/${country}/indicator/${indicator}?format=json&date=${startYear}:${endYear}&per_page=100`;

    const res = await fetch(url);
    const json = await res.json();
    if (!json[1]) {
      alert("No data found.");
      return;
    }

    const records = json[1].reverse();
    const labels = [], values = [];
    const indicatorName = records[0].indicator.value;
    const countryName = records[0].country.value;

    excelData = [["Year", indicatorName]];

    records.forEach(r => {
      if (r.value !== null) {
        labels.push(r.date);
        values.push(r.value);
        excelData.push([r.date, r.value]);
      }
    });

    drawChart(labels, values, chartType, indicatorName, countryName);
  }

  function drawChart(labels, data, type, indicator, country) {
    const ctx = document.getElementById("dataChart").getContext("2d");
    if (chart) chart.destroy();

    chart = new Chart(ctx, {
      type: type,
      data: {
        labels: labels,
        datasets: [{
          label: `${indicator} ‚Äì ${country}`,
          data: data,
          backgroundColor: 'rgba(41, 128, 185, 0.5)',
          borderColor: 'rgba(41, 128, 185, 1)',
          borderWidth: 2,
          fill: type === 'line',
          pointRadius: 4
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: false,
            title: { display: true, text: indicator }
          },
          x: {
            title: { display: true, text: "Year" }
          }
        },
        plugins: {
          tooltip: {
            callbacks: {
              label: ctx => `${ctx.raw} %`
            }
          }
        }
      }
    });
  }

  function downloadExcel() {
    const ws = XLSX.utils.aoa_to_sheet(excelData);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "WorldBankData");
    XLSX.writeFile(wb, `WorldBank_EconData_${new Date().toISOString().slice(0,10)}.xlsx`);
  }

  // Initialize app
  populateCountries().then(fetchData);
</script>

</body>
</html>
